#!/usr/bin/env php
<?php

declare(strict_types=1);

require_once __DIR__.'/harbor_compile.php';
require_once __DIR__.'/harbor_init.php';

$argv = $_SERVER['argv'] ?? [];
$first_argument = $argv[1] ?? null;

if (null === $first_argument || in_array($first_argument, ['-h', '--help'], true)) {
    harbor_print_usage();

    exit(null === $first_argument ? 1 : 0);
}

if (in_array($first_argument, ['init', '/init'], true)) {
    harbor_run_init($argv[2] ?? null);

    exit(0);
}

harbor_run_compile($first_argument);
exit(0);

function harbor_print_usage(): void
{
    fwrite(STDOUT, 'Usage: harbor <path-to-.router|directory> | harbor init [site-name]'.PHP_EOL);
    fwrite(STDOUT, PHP_EOL);
    fwrite(STDOUT, 'Default mode (route compile):'.PHP_EOL);
    fwrite(STDOUT, '  harbor .                 Compile ./.router into ./routes.php'.PHP_EOL);
    fwrite(STDOUT, '  harbor my-site/.router   Compile .router into routes.php'.PHP_EOL);
    fwrite(STDOUT, PHP_EOL);
    fwrite(STDOUT, 'Commands:'.PHP_EOL);
    fwrite(STDOUT, '  init [site-name]         Initialize a new site scaffold.'.PHP_EOL);
}
